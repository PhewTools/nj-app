<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>New Sale</ion-title>
    <ion-button slot="end" fill="clear" (click)="cancel()">
      <ion-icon name="close"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Date Section -->
  <div class="modal-content">
    <ion-label position="stacked">Date</ion-label>
    @defer(){
      <ion-datetime-button class="date-input" datetime="datetime"> </ion-datetime-button>
    }
    <!-- Date Modal -->
      <ion-modal [keepContentsMounted]="true">
        <ng-template>
            <ion-datetime 
              id="datetime" 
              [(ngModel)]="date" 
              presentation="date" 
              type="date" placeholder="Date"
              class="date-input">
            </ion-datetime>
        </ng-template>
      </ion-modal>

    <!-- Client Section -->
    <div class="dropdown-wrapper">
      <ion-label position="stacked">Client</ion-label>
      <app-dropdown-search
        [options]="clients"
        [(selectedOption)]="selectedClient"
        (selectedOptionChange)="onClientSelected($event)"
        placeholder="Search and select client"
        displayField="fullName"
        valueField="id"
        allowClear="true">
      </app-dropdown-search>
    </div>

    <!-- Items Section -->
    <div class="items-section">
      <ion-label class="section-label">Items</ion-label>
      
      <div class="add-item-controls">
        <app-dropdown-search
          #itemDropdown
          [options]="items"
          [(selectedOption)]="selectedItem"
          (selectedOptionChange)="onItemSelected($event)"
          placeholder="Search product/service"
          displayField="name"
          valueField="id"
          allowClear="true"
          class="item-select">
        </app-dropdown-search>
        
        <ion-input
          [(ngModel)]="quantity"
          type="number"
          placeholder="Qty"
          class="quantity-input"
          min="1">
        </ion-input>
        <ion-input
          [(ngModel)]="discount"
          type="number"
          placeholder="Disc"
          class="quantity-input"
          min="0">
        </ion-input>

        <ion-button (click)="addItem()" class="add-item-btn">
          Add
        </ion-button>
      </div>

      <!-- Added Items List -->
      <div class="added-items">
        @for (saleItem of saleItems; track $index) {
          <ion-card class="sale-item-card">
            <ion-card-content>
              <div class="sale-item-info">
                <div class="sale-item-details">
                  <div class="sale-item-name">{{ saleItem.name }}</div>
                  <div class="sale-item-calculation">
                    Qty: {{ saleItem.quantity }} x {{ formatPrice(saleItem.cost) }} - {{ saleItem.discount || 0 }}% = {{ formatPrice(saleItem.total) }}
                  </div>
                </div>
                <ion-icon name="trash" (click)="removeItem($index)" class="delete-item-icon"></ion-icon>
              </div>
            </ion-card-content>
          </ion-card>
        }
      </div>
    </div>

    <!-- Total Section -->
    <div class="total-section">
      <ion-label class="total-label">Total:</ion-label>
      <span class="total-amount">{{ formatPrice(total) }}</span>
    </div>

    <!-- Action Buttons -->
    <div class="modal-actions">
      <ion-button expand="block" (click)="completeSale()" class="complete-button">
        Save
      </ion-button>
      <ion-button expand="block" fill="outline" (click)="cancel()" class="cancel-button">
        Cancel
      </ion-button>
    </div>
  </div>

</ion-content>

